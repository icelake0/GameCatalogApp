# Game Catalog App

This is an API system for a game catalog. The game has players who play it very frequently. The games come in versions so players can own a game in one or more versions of the game.

The system should only store one game play record per player per game per day even if the player played the game(s) multiple times in a day provided they played it alone. If the player played with other people, the system records who started the game and those invited to join.

> Assumption 1: Each of game only allows a maximum of 4 players.
> Assumption 2: Players can only play together if they have the same game versions.

## Testing Apis on Heroku

- Host : https://gbemileke-game-catalog.herokuapp.com
- Post man collection: https://www.getpostman.com/collections/3ffd2fd24b00d0087a99

    [![Run in Postman](https://run.pstmn.io/button.svg)](https://app.getpostman.com/run-collection/3ffd2fd24b00d0087a99)
- `The data on the host server is not as much as would be generated by the script because the host is free and has limited space`
## Local Setup Guide(Ducker)

1) Install and set up doker on your machine 
[Getting started with docker](https://docs.docker.com/compose/gettingstarted/)

2) Ensure docker is up and running on your machine

3) Clone the project
    ```bash
    git clone https://github.com/icelake0/GameCatalogApp.git
    ```
4) Change directory to the project root
    ```bash
    cd GameCatalogApp
    ```
5) Copy .env.example to .env

    ```bash
    cp .env.example .env
    ```

6) Install composer dependencies

    ```bash
    composer install
    ```

7) Build app image
    ```bash
    docker-compose build app
    ```

8) start the app
    ```bash
    docker-compose up -d
    ```

9) run db migration
    ```bash
    docker-compose exec app php artisan migrate
    ```

10) Set up and start workers

    For this stages use `password` as `password` whenever you are prompted to enter `password`

    - start supervisor
    ```bash
    docker-compose exec app sudo supervisord
    ```
    - read the new config
    ```bash
    docker-compose exec app sudo supervisorctl reread
    ```
    - activate configuration
    ```bash
    docker-compose exec app sudo supervisorctl update 
    ```
    - start workers
    ```bash
    docker-compose exec app sudo supervisorctl start
    ```
11) Run the database seeder script
    - This script will simulate some years of game plays ie, players joining the system and playing the game over time
    - The API endpoints will start returning data as soon as the script start running.
    ```bash
    docker-compose exec app php artisan setup-script:seed-game-plays
    ```
12) You can connect to the app locally on this host
 ```bash
    localhost:8100
   ```
13) You can connect to the container DB from outside of the container with tis credncials if you did not nodify it
- DB_CONNECTION=mysql
- DB_HOST=game-catalog-db
- DB_PORT=3307
- DB_DATABASE=game_catalog_app
- DB_USERNAME=game_catalog_app
- DB_PASSWORD=password
- `Take note of how the DB_PORT is different from the custom port`

## Request running stats in response header
- X-Start-Time : Request start time
- X-End-Time: Request end time
- X-Runtime: Request total time teken in Sec
- X-Memory-Used: Request memory usage in byte

# Thought Process
## Date Seed Script
- We can have console command that generate game, version data and also attach versions to a game.
- Since we cant have record of a player playing same game in a day, we need to generate a minimum number of players so we have enough players to play daily before we start recording game play.
- The console command can dispatch a job to start generating Players data
- For the players record generation, we may loop from int 1 to 10000 and dispatch a job on each iteration to generate players, But the loop may time out and make the whole command timeout. so we can just brake the job into queues.

    The command can dispatch say 20 Queues, each will loop form int 1 to 500(ie. 10000/20) and dispatch a job to create one player.
This Way the  command will be looping jist 20 times.
- We can put the Jobs generating the player in a seprate queue handled by few workers so we can get players generated in time.
- The command will also dispatch a watcher job, this job will wakeup say every minute to check if we have enough players to start generating game plays.

    once we have enough data, the job will get distroyed and it will dispatch a different job to start generating GamePlays.
- The GamePlay job can be a recursive job, It will start from a given date, and dispatch 1500 jobs go generate game plays for that same day.
This job will redispatch it self for the next day, It will do this until the difference bwtween the date its generating game play for and the first date of game play is the total number of days we want to generate game play for(3835).
- To keep the GamePlay job in sync and avoid date overlap ie, regenerating games for same date, we will keep the this type of job in a single seprate queue that is processed by just one worker.
- we can put the children jobs dispatched by the GamePlay job in a seprate queue, this queue can get as many worker as we can afford so we can get Gameplay generated as fast as possible.
- This script will simulate some years of game plays ie, players joining the system and playing the game over time
- The API endpoints will start returning data as soon as the script start running.

## Apis Development
- Geting all games will simplay return all games in the system with versions attached, without pagination.
- Get all the players, their games and their gameplays (overall and for each game).

    We will ensure the api is paginated, and the gameplays relation will be paginated also, the meta data in the relation can be used to navigate the relations more if required.

    Some of the endpoints listed below will also power this relation but with additional filters.
- Return all the games played per day and their players.

    We will return a paginated collection of all game played, this endpoint will expect the day you want to get game play for as query param.
- Return all the games played within a date range

    This endpoint will expect you to input the date range you want to get game plays for as quary param. and will return a paginated collection with meta data.
- Return the top 100 players month by month with a link to see the games they played.

    This endpoint may not be paginated, we will use the endpont above as the link required, the filter will be based on the month selected but with an extra filter of the player we are getting games for.
## License
This was built with Laravel framework

The Laravel framework is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).
